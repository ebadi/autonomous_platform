<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Hamid Ebadi @ Infotiv" /><link rel="canonical" href="https://infotiv-research.github.io/autonomous_platform/TEST_DEBUGGING/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Basics - Autonomous Platform Generation 4</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Basics";
        var mkdocs_page_input_path = "TEST_DEBUGGING.md";
        var mkdocs_page_url = "/autonomous_platform/TEST_DEBUGGING/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Autonomous Platform Generation 4
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">High Level overview</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Autonomous Platform Generation 4</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">Changelog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../HARDWARE_DESIGN/">Hardware Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SOFTWARE_DESIGN/">Software Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../HOW_TO_EXTEND/">How to Extend</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">CAN Nodes and Microcontroller</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../CAN_Nodes_Microcontroller_Code/">CAN Nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CAN_Nodes_Microcontroller_Code/Propulsion_Steering/">Propulsion Steering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CAN_Nodes_Microcontroller_Code/Speed_Sensor/">Speed Sensor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CAN_Nodes_Microcontroller_Code/HOW_TO_EXTEND/">How to Extend</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CAN_Nodes_Microcontroller_Code/CAN_LIBRARY_DATABASE/">CAN library</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Hardware Interface Low Level Computer</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Hardware_Interface_Low_Level_Computer/">Hardware Interface Low Level Computer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Hardware_Interface_Low_Level_Computer/HOW_TO_EXTEND/">How to Extend</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Hardware_Interface_Low_Level_Computer/SETUP_OF_RASPBERRY_PI/">Setting up RaspberryPi</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">High Level Control Computer</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../High_Level_Control_Computer/">High Level Control Computer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../High_Level_Control_Computer/IMITATION_LEARNING/">Imitation Learning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../High_Level_Control_Computer/DONKEY_CAR_SETUP/">DonkeyCar simulator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../High_Level_Control_Computer/DIGITAL_TWIN_ROS/">Digital Twins in ROS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power Unit</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Power_Unit/">Power Unit</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Issues and Future work</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ISSUES_AND_FUTURE_WORK/">Issues and Future work</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">CAD designs</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../CAD/">Images</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Test & Debugging</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Basics</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#test-and-debugging-system-level">Test and debugging (System level)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#possible-errors-when-starting-ap4">Possible Errors When Starting AP4</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#docker-container-startingbuilding">Docker Container starting/Building</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-and-debugging-components">Testing and Debugging Components</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tips-and-tricks">TIPS AND TRICKS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#copy-sd-card">Copy SD-card</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#trouble-with-internet">Trouble with internet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#access-raspberry-pi-via-ssh">Access Raspberry Pi via SSH</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#see-ros2-topics-on-raspberry-pi">See ROS2-topics on Raspberry Pi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#merge-your-git-branch-into-main-branch">Merge your git branch into main branch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rqt_graph-on-raspberry">rqt_graph on raspberry</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rqt_graph-on-raspberry_1">rqt_graph on raspberry</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#work-with-docker">Work with docker</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ros2-node">ROS2 node</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#wiring-modifications">Wiring modifications</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#front-control-module">Front control module</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Hardware_Interface_Low_Level_Computer/TEST_DEBUGGING/">Hardware_Interface_Low_Level_Computer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../High_Level_Control_Computer/TEST_DEBUGGING/">High_Level_Control_Computer</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Autonomous Platform Generation 4</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Test & Debugging</li>
      <li class="breadcrumb-item active">Basics</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/infotiv-research/autonomous_platform/edit/master/docs/TEST_DEBUGGING.md">Edit on infotiv-research/autonomous_platform</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="testing-debugging-known-issues-and-future-work">Testing, Debugging, Known Issues and Future Work</h1>
<h2 id="test-and-debugging-system-level">Test and debugging (System level)</h2>
<p>This document collects known problems and issues with the autonomous platform and how to resolve them.</p>
<p>If the existing documentation could not provide a sufficient solution for a problem. Please add your problem and new solution to this document. It will help future members of this project.</p>
<h3 id="possible-errors-when-starting-ap4">Possible Errors When Starting AP4</h3>
<p>Problem: Steering works but not propulsion?</p>
<p>Solution(s): Check that segway is turned on (and charged), check that the the propulsion can be controlled manually by pressing the pedals. The back wheels should spin.</p>
<p>Problem: Segway is beeping? and wheels are turning backwards</p>
<p>Solution: the segway is in reverse mode, quickly press the brake pedals twice. The beeping should stop and segway should move forward when pressing the accelerator pad.</p>
<p>Problem: Segway is beeping and a yellow/orange light flashes on the front console / nose.</p>
<p>Solution: The batteries for the front black box circuits need to be replaced. Open the black compartment on the nose and replace the 6 AA batteries.</p>
<p>Problem: Neither steering or propulsion works.</p>
<p>Solution: Wait for two minutes, The hardware interface software on the raspberry pi could take a while to boot up</p>
<p>Problem: Neither steering or propulsion works after waiting 2 minutes after power ON.</p>
<p>Solution: Connect a screen (portable small screen) and keyboard + mouse to the raspberry pi to verify that it has booted up properly.</p>
<p>Sub-problem: Raspberry Pi could not boot up? Or stuck on boot-up sequence?</p>
<p>Solution: Fix errors using command line, try rebooting system. Follow steps down below to make sure the system is working correctly if the raspberry pi has successfully booted up.</p>
<ol>
<li>Check that the Hardware_Interface docker container is running on the Raspberry Pi
   In a terminal:</li>
</ol>
<pre><code class="language-bash">docker container ps
</code></pre>
<p>Expected output should look something like this, the important thing is that the container is up and running.</p>
<pre><code class="language-bash">CONTAINER ID   IMAGE COMMAND CREATED STATUS PORTS NAMES

xxxx   hardware_interface_low_level_computer_ros2   xxxx   10 seconds ago   Up 10 seconds             ap4hwi
</code></pre>
<p>If the container has not started there are two possibilities: 1. The container is still being built (could take a lot of time if new changes have been pulled). 2. The startup service has not been started properly (could have failed due to docker building errors) <a href="https://www.shubhamdipt.com/blog/how-to-create-a-systemd-service-in-linux/">systemd service guide</a></p>
<p>The startup service will run the 'testing.bash' script located in <code>Hardware_Interface_Low_Level_Computer</code> once called.</p>
<p>In a terminal check that the service has been started</p>
<pre><code class="language-bash">sudo systemctl status startup_lowlevel.service
</code></pre>
<p>output:</p>
<p><img alt="systemd status" src="../Resources/extra_documentation_images/systemd_status.png" />
In the terminal it would explicity say if something has failed and the service did not start properly. Note that it says ERROR in the screenshot above. Something is therefore wrong!</p>
<h3 id="docker-container-startingbuilding">Docker Container starting/Building</h3>
<p>If the docker container is not built properly none of the hardware interface software will start properly.</p>
<p>Check that the router has internet connection</p>
<p>Try rebuilding the docker container:</p>
<pre><code class="language-bash">cd Desktop
cd GIT
cd autonomous_platform
cd Hardware_Interface_Low_level_Computer
docker-compose build
</code></pre>
<p>If this fails, there could be something wrong with the dockerfile or docker-compose file.</p>
<p>One possible error is "error creating overlay mount...". See image below.</p>
<p><img alt="docker build error" src="../Resources/extra_documentation_images/docker_build_error_1.png" /></p>
<p>This could occur because a specific docker layer could not be built. Try pruning the existing docker caches and rebuilding. (This will take some time on Raspberry Pi hardware, enter the commands and grab some coffee!!) Rebuilding a docker container without any saved caches takes about 10 minutes.</p>
<pre><code class="language-bash">docker system prune
</code></pre>
<pre><code class="language-bash">docker-compose build
</code></pre>
<p>Another error that has previously occurred can be seen in the image below.</p>
<p><img alt="docker_build_error" src="../Resources/extra_documentation_images/docker_build_error_2.png" /> Some files in the repository have been corrupted.</p>
<p>To verify that local files are corrupt in the autonomous_platform repository enter the directory and try pulling changes. In a new console:</p>
<pre><code class="language-bash">cd Desktop
cd GIT
cd autonomous_platform_generation_4
git pull
</code></pre>
<p>The output will be something like:</p>
<p><img alt="Raspberry pi corrupted repository" src="../Resources/extra_documentation_images/raspberry_pi_corrupted_repository.png" /></p>
<p>To resolve this issue, delete the corrupted files and pull from gitlab. According to <a href="https://stackoverflow.com/questions/4111728/how-do-i-deal-with-corrupted-git-object-files">this</a> forum post.</p>
<p>In the repository directory run the following commands:</p>
<pre><code class="language-bash">find .git/objects/ -size 0 -delete
git pull
</code></pre>
<h3 id="testing-and-debugging-components">Testing and Debugging Components</h3>
<ol>
<li>Make sure CAN bus messages are sent and received on linux SocketCAN interface
   On the raspberry Pi desktop. Open a new terminal and dump CAN messages</li>
</ol>
<pre><code class="language-bash">candump can0
</code></pre>
<p>Expected output (or similar). The import thing is that can messages are received.</p>
<pre><code class="language-bash">  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  5DC   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
  can0  7D0   [8]  00 00 00 00 00 00 00 00
</code></pre>
<p>If nothing shows up, it means that there is either something wrong with the CAN bus hardware, or in the low-level software.
If the command could not be run, it means that the startup service did not complete and initialize the right commands. (such as sudo ip link set can0 up type can bitrate 1000000) Try rerunning the startup service script by restarting the service.</p>
<pre><code class="language-bash">sudo systemctl daemon-reload
</code></pre>
<pre><code class="language-bash">sudo systemctl enable startup_lowlevel.service
</code></pre>
<p>The next step is to enter the low level software and rerunning the same command. The output should be the same as above. If this it works it means that the linuxsocketcan has been passed through properly.</p>
<pre><code class="language-bash">docker exec -it ap4hwi bash
</code></pre>
<pre><code class="language-bash">candump can0
</code></pre>
<ol>
<li>Check that the ROS2 nodes have been launched correctly</li>
</ol>
<p>First enter the docker hwi container environment</p>
<pre><code class="language-bash">docker exec -it ap4hwi bash
</code></pre>
<p>Secondly, enter the correct directory, source environment variables and set the correct environment variables</p>
<pre><code class="language-bash">cd ap4hwi_ws
source install/setup.bash
export ROS_DOMAIN_ID=1
</code></pre>
<p>To check which ROS2 nodes are up and running, enter</p>
<pre><code class="language-bash">ros2 node list
</code></pre>
<p>The expected output (as of 22/8-2023):</p>
<p><img alt="ROS active nodes" src="../Resources/extra_documentation_images/hwi_ros_active_nodes.png" /></p>
<p>If the correct ROS2 nodes have not been started, check that the container built successfully. Try rebuilding the container manually. Make sure the Raspberry Pi has internet access.</p>
<p>IF the container has started properly yet no ROS2 node is up, it can mean that the ROS2 software packages could not be built. To check this, try building them manually and running the ROS2 launch file.</p>
<p>Enter the docker container</p>
<pre><code class="language-bash">docker exec -it ap4hwi bash
</code></pre>
<p>Navigate into the ROS2 workspace</p>
<pre><code class="language-bash">cd ap4hwi_ws
</code></pre>
<p>Source ROS2 environment</p>
<pre><code class="language-bash">source /opt/ros/humble/setup.bash
</code></pre>
<p>Build the low level software ROS2 components</p>
<pre><code class="language-bash">colcon build
</code></pre>
<p>It will explicitly output in the terminal how many packages succeeded / failed. A C / Python output will be noted in the terminal. If any of packages failed, resolve the issue wich is presented in the terminal.</p>
<p>Source new ROS2 environment</p>
<pre><code class="language-bash">source install/setup.bash
</code></pre>
<p>set environment variable</p>
<pre><code class="language-bash">export ROS_DOMAIN_ID=1
</code></pre>
<p>Run the ROS2 launch file which starts up the software nodes</p>
<pre><code class="language-bash">ros2 launch launch_hwi_software_pkg launch_hwi_ros_software.launch.py
</code></pre>
<p>The output should look something similar to this once the startup script has been run:</p>
<p><img alt="ROS2 launch" src="../Resources/extra_documentation_images/ros2_launch_successfull.png" /></p>
<p>Try restarting the container and verify that the corrected nodes has been started successfully as described above.</p>
<pre><code>VERY IMPORTANT: MAKE SURE THAT THE hwi_startup.bash script is actually run when the container is spun up. Look into the docker-compose file in `Hardware_Interface_Low_Level_Computer` directory. 


There is a command argument. command: xxxxxx

!!!!!!!!!!!!!!!!!!!!!!
MAKE SURE THAT #command: /bin/bash -c &quot;./hwi_startup.bash&quot; IS UNCOMMENTED
!!!!!!!!!!!!!!!!!!!!!!

Whilst debugging code it can be useful to comment this line out but the software will not start up when the container is started. It will cause a lot of confusion.
</code></pre>
<p>This is the expected output when the container is manually started:</p>
<p><img alt="docker manual start" src="../Resources/extra_documentation_images/docker_container_manual_start.png" /></p>
<ol>
<li>Check communication between low-level-software and SPCU</li>
</ol>
<p>If the expected ROS2 nodes have been started correctly and the platform still cannot be controlled. Verify that the velocity command from <code>\cmd_vel</code> topic is being published on.</p>
<pre><code class="language-bash">ros2 topic echo /cmd_vel
</code></pre>
<p>Next, verify that the vehicle controller is outputting desired set voltages for pedals and steering</p>
<pre><code class="language-bash">ros2 topic echo @TODO ACC + BREAK + STEERING ANGLE
</code></pre>
<p>Next Verify that the SPCU software and low-level software can communicate. The low-level software can request a ping signal from the ECUs on one topic and receive ping confirmations on another. The ping will be sent over the CAN</p>
<h2 id="tips-and-tricks">TIPS AND TRICKS</h2>
<p>This is a logbook to continuously document what has been done. Could probably be copied
if documentation is needed somewhere.</p>
<p><strong>21/01-2025</strong></p>
<p><strong>Before starting we would advise to copy the SD card for safety in case something goes wrong. This is done by imaging.</strong></p>
<hr />
<h3 id="copy-sd-card">Copy SD-card</h3>
<p><strong>If you are on linux follow these steps, otherwise there are options for windows called Win32
Disk Imager and DD for Windows however i don't know how safe these are and they require
admin privileges.</strong></p>
<p>open terminal and to find SD-card enter the following:\
<code>sudo fdisk -l</code></p>
<p>We saw:\
<span style="font-family: 'Roboto Mono', monospace;"><pre>
Device    Boot Start   End        Sectors    Size    Id    Type\
/dev/sda1  *   2048    526335     526335     256M    C     W95  FAT32 (LBA)\
/dev/sda2      526336  249737182  249210847  118.8G  83    Linux
</pre></span></p>
<p>So SD card is /dev/sda (*1 and *2 are partitions)</p>
<p>Unmount the device by:\
<code>sudo umount /dev/sda</code></p>
<p>Create an image of the SD-card. OBS make sure you have enough space, it will copy empty space aswell:\
<code>sudo dd if=/dev/sda of~/sd-card-copy.img bs=1M status=progress</code></p>
<p>This takes a while</p>
<hr />
<h3 id="trouble-with-internet">Trouble with internet</h3>
<p>Apparently if the router is on, it overwrites the Wifi connection. Either use wifi connection alone or with cable connected to WAN. Otherwise it won't connect to the internet even though you are still able to ping devices on the same WiFi.</p>
<hr />
<h3 id="access-raspberry-pi-via-ssh">Access Raspberry Pi via SSH</h3>
<p><strong>This can make it easier to pull from git and access the Raspberry withouth needing to move from and to it</strong>
open a terminal on the Raspberry and install the necessary file by entering:\
<code>sudo apt install openssh-server</code></p>
<p>Check the status by entering:\
<code>sudo systemctl status ssh</code></p>
<p>It should return something like this:</p>
<p><span style="font-family: 'Roboto Mono', monospace; font-size: 1em;"><pre>ssh.service - OpenBSD Secure Shell server\
Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)\
Active: active (running) since Mon 2020-06-01 12:34:00 CEST; 9h ago
</pre></span></p>
<p>Dissable the firewall to be able to connect from another computer by entering:\
<code>sudo ufw allow ssh</code></p>
<p>To connect to the Raspberry via another compouter, we first need the raspberry pi's "\<ip_address>" and "\<user>"
To find these write the following:</p>
<p>for  "\<user>", enter:\
<code>whoami</code>\
for "\<ip_address>", enter:\
<code>ifconfig</code></p>
<p>You should see many outputs something similar to:</p>
<p><span style="font-family: 'Roboto Mono', monospace; font-size: 1em;"><pre>
wlan0: flags=4163/\<UP,BROADCAST,RUNNING,MULTICAST/>  mtu 1500\
<code>inet 192.168.1.150</code>  netmask 255.255.255.0  broadcast 192.168.1.255\
inet6 fe80::7a8:fdc8:4fdf:d6f2  prefixlen 64  scopeid 0x20/<link/>\
ether dc:a6:32:7c:40:aa  txqueuelen 1000  (Ethernet)\
RX packets 5258  bytes 1564626 (1.5 MB)\
RX errors 0  dropped 5  overruns 0  frame 0\
TX packets 2106  bytes 563087 (563.0 KB)\
TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\
</pre></span></p>
<p>You can also check the "\<ip_address>" by checking WiFi-settings-&gt;settings
in our case "\<user>"=ap4 and "\<ip_address>"=192.168.1.150 however these may change.</p>
<p>Open a terminal on <strong>the computer you want to access the Raspberry from</strong> and enter:\
<code>ssh &lt;user&gt;@&lt;ip_address&gt;</code></p>
<p>Enter password if necessary, AP42023 in our case.</p>
<p>Now you are in!</p>
<hr />
<h3 id="see-ros2-topics-on-raspberry-pi">See ROS2-topics on Raspberry Pi</h3>
<p><strong>To see the ROS2 topics on the raspberry on the Gokart, the below steps are a guide on how to get access to the topics and the workspace from the ROS2 environment.</strong></p>
<p>First you need the "\<container_name>", find this by opening a terminal on the Raspberry and entering:\
<code>docker ps</code></p>
<p>This should open something similar to:\
<span style="font-family: 'Roboto Mono', monospace; font-size: 1em;"><pre>CONTAINER ID  IMAGE       COMMAND               CREATED    STATUS    PORTS NAMES\
f0c3b88eb9dc  ros2_image   "/ros_entrypoint.sh"   5 min ago  Up 5 min        ap4hwi</pre>
</span></p>
<p>Where you find "\<container_name>" under NAMES, in our case it was ap4hwi.</p>
<p>Now enter:\
<code>docker exec -it &lt;container_name&gt; /bin/bash</code></p>
<p>This should open the container as an interactive shell where you can access the ROS2 environment.</p>
<p>To see the topics, enter:\
<code>ros2 topic list</code></p>
<p>This should return all active topics which should look something like the following:</p>
<p><span style="font-family: 'Roboto Mono', monospace; font-size: 1em;"><pre>/GET_cmd_vel\
/Get_position\
/joystick_cmd_vel\
/etc…
</pre></span></p>
<p>To see the values or whats happening in a topic enter:\
<code>ros2 topic echo &lt;topic_name&gt;</code></p>
<p>Now you should get some output. I would recommend the topic /joystick_cmd_vel which is quite interactive.</p>
<hr />
<h3 id="merge-your-git-branch-into-main-branch">Merge your git branch into main branch</h3>
<p><strong>Here is a guide for how you can merge your branch to the main branch on gitlab.</strong></p>
<p>Open the terminal and locate your local git repo and enter:\
<code>cd &lt;your_local_repo_directory&gt;</code></p>
<p>Check if there are uncommitted changes by entering:\
<code>git status</code></p>
<p>To switch to the main branc,h enter:\
<code>git checkout main</code></p>
<p>To pull the latest changes from remote main, enter:\
<code>git pull origin main</code></p>
<p>Now to merge your branch into main, enter:\
<code>git merge &lt;your_branch_name&gt; -m "merge message"</code></p>
<p>And lastly to push the merged changes to the remote repository, enter:\
<code>git push origin main</code></p>
<hr />
<h3 id="rqt_graph-on-raspberry">rqt_graph on raspberry</h3>
<p><strong>To get the rqp_graph command display show on the raspberry pi you need to make sure the display settings are the same on both the raspberry and the docker. In the docker-compose.yaml file they are set to the same, however, on startup the raspberry display is set to <code>&lt;empty string&gt;</code> which makes it non compatible.</strong></p>
<p>Open a terminal on the raspberry and enter:\
<code>export DISPLAY=:0</code></p>
<p>Now start the docker, and in the same terminal as before enter:\
<code>xhost +local:docker</code></p>
<p>If the docker now has the same display port you should be good to go. check this by entering:\
<code>echo $DISPLAY</code></p>
<p>If you started the docker after you set the display, this should output:\
<span style="font-family: 'Roboto Mono', monospace; font-size: 1em;"><pre>:0
</pre></span></p>
<p>Otherwise in the docker terminal enter:\
<code>export DISPLAY=:0</code></p>
<p>Now you can run the command rqt_graph to see how nodes are communicating visually</p>
<hr />
<h3 id="rqt_graph-on-raspberry_1">rqt_graph on raspberry</h3>
<p><strong>To get the rqp_graph command display show on the raspberry pi you need to make sure the display settings are the same on both the raspberry and the docker. In the docker-compose.yaml file they are set to the same, however, on startup the raspberry display is set to <code>&lt;empty string&gt;</code> which makes it non compatible.</strong></p>
<p>Open a terminal on the raspberry and enter:\
<code>export DISPLAY=:0</code></p>
<p>Now start the docker, and in the same terminal as before enter:\
<code>xhost +local:docker</code></p>
<p>If the docker now has the same display port you should be good to go. check this by entering:\
<code>echo $DISPLAY</code></p>
<p>If you started the docker after you set the display, this should output:\
<span style="font-family: 'Roboto Mono', monospace; font-size: 1em;"><pre>:0
</pre></span></p>
<p>Otherwise in the docker terminal enter:\
<code>export DISPLAY=:0</code></p>
<p>Now you can run the comman drqt_graph to see how nodes are communicating visually</p>
<hr />
<h3 id="work-with-docker">Work with docker</h3>
<p><strong>Here is a quick guide on how to work with the necesarry docker commands to get started.</strong>\
To work with docker you need to find the dockerfile and/or docker-compose.yaml file you wish to edit. If you want to edit the software which connects the hardware, cd to "\<Hardware_Interface_Low_Level_Computer>". There open a terminal.</p>
<p>Normally the hardware docker should run on startup so if you want to make changes make sure the docker is down. Do this by entering:\
<code>docker-compose down</code></p>
<p>Now do the changes you want to either the docker-compose.yaml or the dockerfile file and run the docker by entering:\
<code>docker-compose up -d</code></p>
<p>The "\&lt;-d&gt;" stands for detached and starts the service in the background so you can still use your terminal, if this is not what yuo want runt the same command without "\&lt;-d&gt;". The docker should now be running.</p>
<p>If there occurs some errors try by solving entering:\
<code>docker-compose down --volumes --remove-orphans</code></p>
<p>and\
<code>docker-compose build --no-cache</code></p>
<p>and then run the docker again.</p>
<hr />
<h3 id="ros2-node">ROS2 node</h3>
<p><strong>To create a ROS2 node some things have to be setup. First you need ROS2 installed, this can be done on windows but it's easier on linux. This guide will focus on working with ROS2 on the Raspberry which already has ROS2 installed.</strong></p>
<p>The ROS2 environment is set up in the docker so enter the docker first by entering:\
<code>docker exec -it &lt;container_name&gt; /bin/bash</code></p>
<p>CD to your soruce directory which in my case is "\<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#111;&#111;&#116;&#64;&#97;&#112;&#52;&#45;&#104;&#119;&#45;&#105;&#110;&#116;&#101;&#114;&#102;&#97;&#99;&#101;&#45;&#114;&#112;&#105;&#52;&#58;&#126;&#47;&#97;&#112;&#52;&#95;&#104;&#119;&#105;&#95;&#100;&#111;&#99;&#107;&#101;&#114;&#95;&#100;&#105;&#114;&#47;&#97;&#112;&#52;&#104;&#119;&#105;&#95;&#119;&#115;&#47;&#115;&#114;&#99;">&#114;&#111;&#111;&#116;&#64;&#97;&#112;&#52;&#45;&#104;&#119;&#45;&#105;&#110;&#116;&#101;&#114;&#102;&#97;&#99;&#101;&#45;&#114;&#112;&#105;&#52;&#58;&#126;&#47;&#97;&#112;&#52;&#95;&#104;&#119;&#105;&#95;&#100;&#111;&#99;&#107;&#101;&#114;&#95;&#100;&#105;&#114;&#47;&#97;&#112;&#52;&#104;&#119;&#105;&#95;&#119;&#115;&#47;&#115;&#114;&#99;</a>" and create a package by entering:\
<code>ros2 pkg create &lt;my_pkg_name&gt; --build-type ament_python --dependencies rclpy</code></p>
<p>Now you have to change permissions so others you can push it to hit by entering:\
<code>chmod 777 &lt;my_pkg_name&gt;</code></p>
<p>Now go to the directory the python files are to be created in. This is "\<my_pkg_name>/\<my_pkg_name>" so enter:\
<code>cd &lt;my_pkg_name&gt;/&lt;my_pkg_name&gt;</code></p>
<p>Create a python file by entering:\
<code>touch &lt;filename.py&gt;</code></p>
<p>You also have to make it an executable by entering:\
<code>chmod +x &lt;filename.py&gt;</code></p>
<p>You can check that it has become an executable by entering <code>ls</code> and if "\<filename.py>" is highlighted in green, it is done.\
Now you can write your code in the "\<filename.py>" file. When that is done, don't forget to add any imports to the <code>packages.xml</code> file and add your entrypoints to the<code>setup.py</code> file.</p>
<p>Add packages by adding:\
<code>&lt;depend&gt;import_to_add&lt;/depend&gt;</code>\
under the "<license>licenses</license>" line.</p>
<p>Add entrypoints by adding:</p>
<pre style="font-family: 'Roboto Mono', monospace; font-size: 1em;">
<code>
entry_points={
    'console_scripts': [
        "example_node1 = my_pkg_name.filename1:main",
        "example_node2 = my_pkg_name.filename2:main"
    ],
}
</code>
</pre>

<p>When this is done you can build your work space by cd to your work space directory and entering:\
<code>colcon build</code></p>
<p>When this is done you need to source your variables by entering:\
<code>source ~/ap4_hwi_docker_dir/ap4hwi_ws/install/setup.bash</code></p>
<p>Thi also depends on your container name and my followed from the docker environmkent mentioned above.</p>
<p>Now you can finally run your ROS2 node by entering:\
<code>ros2 run &lt;pkg_name&gt; &lt;node_name&gt;</code></p>
<hr />
<h2 id="wiring-modifications">Wiring modifications</h2>
<p><img alt="PCB Side: Wiring between front control module, ninebot engine and power adapter." src="connect%20male%20connectors%20to%20PCB%20at%20PCB%20side.jpg" /></p>
<p><img alt="Connector side: Wiring between front control module, ninebot engine and power adapter." src="connect%20male%20connectors%20to%20PCB.jpg" /></p>
<p>Instruction:</p>
<p>The connectors used in this place are JST XH connectors.</p>
<p>They can be found (during the writing of this text) in the lab and crimped with the tool on the picture that also can be found in the lab.</p>
<p><img alt="Crimp tool, connectors and lead pins" src="lead%20in%20crimp%20tool%20use%20A.jpg" /></p>
<p><img alt="Crimp tool usage" src="jst%20XH%20Lead%20conector%20pins%20and%20Crimp%20tool.jpg" /></p>
<p>A better result is obtained when the lead pin is put in the smalled slot. THat requires a little bending of the clamps that are meant for the insulation part of the wire.</p>
<h2 id="front-control-module">Front control module</h2>
<p><img alt="Front Control MOdule connection to Power Adapter, Ninebot Chassis connector and front chassis connector" src="wiring%20to%20Ninebot%20Engine.png" /></p>
<p>The Front control module is a control module, mounted on top of the steering column.
Reads status from the brake and accelerator pedal and communicates that to the ninebot engine.
Actuates a head lamp, controlled from the ninebot engine.</p>
<p>IT communicates both wired and wireless with the Ninebot Engine.</p>
<p>THe wired interface contains a wake up signal.
Other communication is wireless.</p>
<p>Ratio:
Unplugging the wired interface does not interfere with operation of the motor. Gas and brakepedal work as usual when disconnected.
Possibly the wire is only used to wake up the front control module.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../CAD/" class="btn btn-neutral float-left" title="Images"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Hardware_Interface_Low_Level_Computer/TEST_DEBUGGING/" class="btn btn-neutral float-right" title="Hardware_Interface_Low_Level_Computer">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../CAD/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Hardware_Interface_Low_Level_Computer/TEST_DEBUGGING/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
